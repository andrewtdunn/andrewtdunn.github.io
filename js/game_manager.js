function GameManager(e,t,a,i){this.size=e,this.inputManager=new t,this.storageManager=new i,this.actuator=new a,this.startTiles=2,this.inputManager.on("move",this.move.bind(this)),this.inputManager.on("restart",this.restart.bind(this)),this.inputManager.on("keepPlaying",this.keepPlaying.bind(this)),this.inputManager.on("clearAll",this.clearAll.bind(this)),this.setup()}GameManager.prototype.restart=function(){this.storageManager.clearGameState(),this.actuator.continueGame(),this.setup()},GameManager.prototype.keepPlaying=function(){this.keepPlaying=!0,this.actuator.continueGame()},GameManager.prototype.clearAll=function(){this.storageManager.clearHistory()},GameManager.prototype.isGameTerminated=function(){if(this.over||this.won&&!this.keepPlaying){var e=new Audio("sounds/ClosingCredits.mp3");return e.play(),!0}return!1},GameManager.prototype.setup=function(){var e=this.storageManager.getGameState();e?(this.grid=new Grid(e.grid.size,e.grid.cells),this.score=e.score,this.over=e.over,this.won=e.won,this.keepPlaying=e.keepPlaying):(this.grid=new Grid(this.size),this.score=0,this.over=!1,this.won=!1,this.keepPlaying=!1,this.addStartTiles()),this.actuate()},GameManager.prototype.addStartTiles=function(){for(var e=0;e<this.startTiles;e++)this.addRandomTile()},GameManager.prototype.addRandomTile=function(){if(this.grid.cellsAvailable()){var e=Math.random()<.9?2:4,t=new Tile(this.grid.randomAvailableCell(),e);this.grid.insertTile(t)}},GameManager.prototype.actuate=function(){this.storageManager.getBestScore()<this.score&&this.storageManager.setBestScore(this.score),this.over?this.storageManager.clearGameState():this.storageManager.setGameState(this.serialize()),this.actuator.actuate(this.grid,{score:this.score,over:this.over,won:this.won,bestScore:this.storageManager.getBestScore(),terminated:this.isGameTerminated()})},GameManager.prototype.serialize=function(){return{grid:this.grid.serialize(),score:this.score,over:this.over,won:this.won,keepPlaying:this.keepPlaying}},GameManager.prototype.prepareTiles=function(){this.grid.eachCell(function(e,t,a){a&&(a.mergedFrom=null,a.savePosition())})},GameManager.prototype.moveTile=function(e,t){this.grid.cells[e.x][e.y]=null,this.grid.cells[t.x][t.y]=e,e.updatePosition(t)},GameManager.prototype.move=function(e){var t=this;if(!this.isGameTerminated()){var a,i,r=this.getVector(e),s=this.buildTraversals(r),o=!1,n=0;if(this.prepareTiles(),s.x.forEach(function(e){s.y.forEach(function(s){if(a={x:e,y:s},i=t.grid.cellContent(a)){var l=t.findFarthestPosition(a,r),u=t.grid.cellContent(l.next);if(u&&u.value===i.value&&!u.mergedFrom){var h=new Tile(l.next,2*i.value);h.mergedFrom=[i,u],t.grid.insertTile(h),t.grid.removeTile(i),i.updatePosition(l.next),console.log("merged value is: "+h.value),t.score+=h.value,h.value>n&&(n=h.value),2048===h.value&&(t.won=!0)}else t.moveTile(i,l.farthest);t.positionsEqual(a,i)||(o=!0)}})}),o){switch(this.addRandomTile(),console.log("highestMergeValue"+n),n){case 0:var l=new Audio("sounds/tos-turboliftdoor.mp3");l.play();break;case 4:var u=new Audio("sounds/tos-computer-01.mp3");u.play();break;case 8:var h=new Audio("sounds/tos-computer-02.mp3");h.play();break;case 16:var p=new Audio("sounds/tos-computer-03.mp3");p.play();break;case 32:var c=new Audio("sounds/tos-computer-04.mp3");c.play();break;case 64:var g=new Audio("sounds/tos-computer-05.mp3");g.play();break;case 128:var d=new Audio("sounds/tos-computer-06.mp3");d.play();break;case 256:var m=new Audio("sounds/tos-computer-07.mp3");m.play();break;case 512:var v=new Audio("sounds/Spock_Livelong.mp3");v.play();break;case 1024:var y=new Audio("sounds/picard26.mp3");y.play();break;case 2048:var f=new Audio("sounds/Opening_Remastered.mp3");f.play()}this.movesAvailable()||(this.over=!0),this.actuate()}}},GameManager.prototype.getVector=function(e){var t={0:{x:0,y:-1},1:{x:1,y:0},2:{x:0,y:1},3:{x:-1,y:0}};return t[e]},GameManager.prototype.buildTraversals=function(e){for(var t={x:[],y:[]},a=0;a<this.size;a++)t.x.push(a),t.y.push(a);return 1===e.x&&(t.x=t.x.reverse()),1===e.y&&(t.y=t.y.reverse()),t},GameManager.prototype.findFarthestPosition=function(e,t){var a;do a=e,e={x:a.x+t.x,y:a.y+t.y};while(this.grid.withinBounds(e)&&this.grid.cellAvailable(e));return{farthest:a,next:e}},GameManager.prototype.movesAvailable=function(){return this.grid.cellsAvailable()||this.tileMatchesAvailable()},GameManager.prototype.tileMatchesAvailable=function(){for(var e,t=this,a=0;a<this.size;a++)for(var i=0;i<this.size;i++)if(e=this.grid.cellContent({x:a,y:i}))for(var r=0;4>r;r++){var s=t.getVector(r),o={x:a+s.x,y:i+s.y},n=t.grid.cellContent(o);if(n&&n.value===e.value)return!0}return!1},GameManager.prototype.positionsEqual=function(e,t){return e.x===t.x&&e.y===t.y};